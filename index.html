<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Ù…Ø§ÙÙŠØ§ â€” Ù…Ø¯ÙŠØ± Ø§Ù„Ø¬Ù„Ø³Ø©</title>

  <!-- Tailwind CDN (Ø³Ø±ÙŠØ¹ ÙˆÙ…Ù…ØªØ§Ø² Ù„Ù„Ø¬ÙˆØ§Ù„) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø¬ÙˆØ§Ù„ + Ø­ÙˆØ§Ù Ø¢Ù…Ù†Ø© (iPhone notch) */
    body { padding-bottom: env(safe-area-inset-bottom); }
    .tap { -webkit-tap-highlight-color: transparent; }
  </style>
</head>

<body class="bg-slate-950 text-slate-100 min-h-screen">
  <header class="sticky top-0 z-40 bg-slate-950/90 backdrop-blur border-b border-slate-800">
    <div class="max-w-md mx-auto px-4 py-3 flex items-center justify-between">
      <div class="font-extrabold text-lg">ğŸ•µï¸â€â™‚ï¸ Ù…Ø§ÙÙŠØ§</div>
      <button id="btnResetAll" class="tap text-sm px-3 py-2 rounded-xl bg-slate-800 hover:bg-slate-700 border border-slate-700">
        Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·
      </button>
    </div>
  </header>

  <main class="max-w-md mx-auto px-4 py-5 space-y-4">
    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ -->
    <section id="screenSetup" class="space-y-4">
      <div class="rounded-2xl border border-slate-800 bg-slate-900/40 p-4 shadow">
        <h1 class="text-xl font-extrabold">Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù„Ø¹Ø¨Ø© (Ø¬ÙˆØ§Ù„)</h1>
        <p class="text-slate-300 text-sm mt-1">
          Ø§ÙƒØªØ¨ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†ØŒ Ø§Ø®ØªØ± Ø§Ù„Ø£Ø¯ÙˆØ§Ø±ØŒ Ø«Ù… ÙˆØ²Ù‘Ø¹Ù‡Ø§ Ø¨Ø³Ø±Ù‘ÙŠØ© Ù„Ø§Ø¹Ø¨-Ù„Ø§Ø¹Ø¨.
        </p>
      </div>

      <!-- Ø¥Ø¶Ø§ÙØ© Ù„Ø§Ø¹Ø¨ -->
      <div class="rounded-2xl border border-slate-800 bg-slate-900/40 p-4">
        <label class="text-sm text-slate-300">Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨</label>
        <div class="mt-2 flex gap-2">
          <input id="playerName"
                 class="w-full rounded-2xl bg-slate-950 border border-slate-800 px-4 py-3 outline-none focus:border-sky-500"
                 placeholder="Ù…Ø«Ø§Ù„: Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡" />
          <button id="btnAddPlayer"
                  class="tap shrink-0 px-4 py-3 rounded-2xl bg-sky-600 hover:bg-sky-500 font-bold">
            Ø¥Ø¶Ø§ÙØ©
          </button>
        </div>

        <div class="mt-3 flex items-center justify-between text-xs text-slate-400">
          <span>Ù†ØµÙŠØ­Ø©: 7+ Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø£ÙØ¶Ù„</span>
          <button id="btnAddSample" class="tap underline hover:text-slate-200">Ø¥Ø¶Ø§ÙØ© Ø£Ø³Ù…Ø§Ø¡ ØªØ¬Ø±ÙŠØ¨ÙŠØ©</button>
        </div>
      </div>

      <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† -->
      <div class="rounded-2xl border border-slate-800 bg-slate-900/40 p-4">
        <div class="flex items-center justify-between">
          <h2 class="font-extrabold">Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ†</h2>
          <span id="playersCount" class="text-xs text-slate-300 bg-slate-800 border border-slate-700 px-2 py-1 rounded-xl">0</span>
        </div>

        <div id="playersList" class="mt-3 space-y-2"></div>

        <div class="mt-3 text-xs text-slate-400">
          Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ âœ• Ù„Ø­Ø°Ù Ù„Ø§Ø¹Ø¨.
        </div>
      </div>

      <!-- Ø§Ù„Ø£Ø¯ÙˆØ§Ø± -->
      <div class="rounded-2xl border border-slate-800 bg-slate-900/40 p-4 space-y-3">
        <h2 class="font-extrabold">Ø§Ù„Ø£Ø¯ÙˆØ§Ø±</h2>
        <p class="text-xs text-slate-300">
          Ø§Ø®ØªØ± Ø¹Ø¯Ø¯ ÙƒÙ„ Ø¯ÙˆØ±. Ø³ÙŠØªÙ… ØªÙˆØ²ÙŠØ¹Ù‡Ø§ Ø¹Ø´ÙˆØ§Ø¦ÙŠÙ‹Ø§. Ø§Ù„Ø¨Ø§Ù‚ÙŠ ÙŠØµÙŠØ±ÙˆÙ† "Ù…ÙˆØ§Ø·Ù†".
        </p>

        <div id="rolesBox" class="space-y-3"></div>

        <div class="rounded-2xl border border-slate-800 bg-slate-950 p-3 text-xs text-slate-300">
          <div class="font-bold mb-1">Ù…Ù„Ø§Ø­Ø¸Ø©</div>
          <div>Ù„Ùˆ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± Ø£ÙƒØ¨Ø± Ù…Ù† Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†ØŒ Ù…Ø§ Ø±Ø§Ø­ ÙŠÙƒÙ…Ù„ Ø§Ù„ØªÙˆØ²ÙŠØ¹.</div>
        </div>
      </div>

      <button id="btnAssignRoles"
              class="tap w-full px-4 py-4 rounded-2xl bg-emerald-600 hover:bg-emerald-500 font-extrabold text-lg">
        ğŸ² ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± (Ø¨Ø¯Ø¡ Ø§Ù„ÙƒØ´Ù Ø§Ù„Ø³Ø±ÙŠ)
      </button>
    </section>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„ÙƒØ´Ù Ø§Ù„Ø³Ø±ÙŠ -->
    <section id="screenReveal" class="hidden space-y-4">
      <div class="rounded-2xl border border-slate-800 bg-slate-900/40 p-4">
        <div class="flex items-center justify-between">
          <div>
            <div class="text-xs text-slate-300">Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
            <div id="revealPlayerName" class="text-xl font-extrabold mt-1"></div>
          </div>
          <div class="text-xs text-slate-300 bg-slate-800 border border-slate-700 px-3 py-2 rounded-2xl">
            <span id="revealIndex">1</span>/<span id="revealTotal">1</span>
          </div>
        </div>

        <div class="mt-3 text-sm text-slate-300">
          Ù…Ø±Ù‘Ø± Ø§Ù„Ø¬ÙˆØ§Ù„ Ù„Ù„Ø§Ø¹Ø¨ Ù‡Ø°Ø§. Ø§Ø¶ØºØ· "Ø£Ø¸Ù‡Ø± Ø¯ÙˆØ±ÙŠ" Ø«Ù… "Ø¥Ø®ÙØ§Ø¡" Ø¨Ø¹Ø¯ Ù…Ø§ ÙŠØ´ÙˆÙ.
        </div>
      </div>

      <div class="grid grid-cols-2 gap-2">
        <button id="btnPrevReveal" class="tap px-4 py-4 rounded-2xl bg-slate-800 hover:bg-slate-700 border border-slate-700 font-bold">
          â¬…ï¸ Ø§Ù„Ø³Ø§Ø¨Ù‚
        </button>
        <button id="btnNextReveal" class="tap px-4 py-4 rounded-2xl bg-slate-800 hover:bg-slate-700 border border-slate-700 font-bold">
          Ø§Ù„ØªØ§Ù„ÙŠ â¡ï¸
        </button>
      </div>

      <button id="btnShowRole" class="tap w-full px-4 py-4 rounded-2xl bg-sky-600 hover:bg-sky-500 font-extrabold text-lg">
        ğŸ‘ï¸ Ø£Ø¸Ù‡Ø± Ø¯ÙˆØ±ÙŠ
      </button>

      <button id="btnHideRole" class="hidden tap w-full px-4 py-4 rounded-2xl bg-slate-800 hover:bg-slate-700 border border-slate-700 font-bold">
        ğŸ™ˆ Ø¥Ø®ÙØ§Ø¡
      </button>

      <div id="roleCard" class="hidden rounded-2xl border border-slate-800 bg-slate-900/40 p-4">
        <div class="text-xs text-slate-300">Ø¯ÙˆØ±Ùƒ</div>
        <div id="roleName" class="text-2xl font-extrabold mt-1"></div>
        <div id="roleHint" class="text-slate-300 text-sm mt-2"></div>
      </div>

      <button id="btnGoBackSetup" class="tap w-full px-4 py-4 rounded-2xl bg-slate-900 hover:bg-slate-800 border border-slate-800 font-bold">
        Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø¥Ø¹Ø¯Ø§Ø¯
      </button>
    </section>
  </main>

<script>
(() => {
  const $ = (id) => document.getElementById(id);

  // ====== Ø£Ø¯ÙˆØ§Ø± Ø¬Ø§Ù‡Ø²Ø© (Ø£Ø³Ø§Ø³ÙŠØ© + Ø¥Ø¶Ø§ÙÙŠØ©) ======
  // ÙÙŠ Ø§Ù„Ø®Ø·ÙˆØ© 2 Ø¨Ù†Ø¶ÙŠÙ Ù…Ù†Ø·Ù‚ Ø§Ù„Ù„ÙŠÙ„/Ø§Ù„Ù†Ù‡Ø§Ø± Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±
  const ROLE_DEFS = [
    { key:"mafia",   name:"Ù…Ø§ÙÙŠØ§",     defaultCount:1, hint:"Ø¨Ø§Ù„Ù„ÙŠÙ„ ØªØ®ØªØ§Ø±ÙˆÙ† Ø¶Ø­ÙŠØ©. Ø¨Ø§Ù„Ù†Ù‡Ø§Ø± Ø­Ø§ÙˆÙ„ÙˆØ§ Ù…Ø§ ØªÙ†ÙƒØ´ÙÙˆÙ†." },
    { key:"don",     name:"Ø¯ÙˆÙ† (Ø²Ø¹ÙŠÙ… Ø§Ù„Ù…Ø§ÙÙŠØ§)", defaultCount:0, hint:"Ù…Ø§ÙÙŠØ§ Ø®Ø§ØµØ©: ÙŠÙ‚ÙˆØ¯ Ø§Ù„ÙØ±ÙŠÙ‚ (Ø­Ø³Ø¨ Ù‚ÙˆØ§Ù†ÙŠÙ†ÙƒÙ…)." },
    { key:"doctor",  name:"Ø·Ø¨ÙŠØ¨",     defaultCount:1, hint:"Ø¨Ø§Ù„Ù„ÙŠÙ„ ØªØ®ØªØ§Ø± Ø´Ø®Øµ ØªÙ†Ù‚Ø°Ù‡." },
    { key:"detective",name:"Ù…Ø­Ù‚Ù‚",    defaultCount:1, hint:"Ø¨Ø§Ù„Ù„ÙŠÙ„ ØªØ­Ù‚Ù‚ ÙÙŠ Ù„Ø§Ø¹Ø¨ ÙˆØªØ¹Ø±Ù Ø¥Ø°Ø§ Ù‡Ùˆ Ù…Ø§ÙÙŠØ§ Ø£Ùˆ Ù„Ø§." },

    // Ø£Ø¯ÙˆØ§Ø± Ø¥Ø¶Ø§ÙÙŠØ©
    { key:"bodyguard", name:"Ø­Ø§Ø±Ø³", defaultCount:0, hint:"ÙŠØ­Ù…ÙŠ Ù„Ø§Ø¹Ø¨ (Ù‚ÙˆØ§Ù†ÙŠÙ† Ø­Ø³Ø¨ Ø§ØªÙØ§Ù‚ÙƒÙ…)." },
    { key:"sniper",    name:"Ù‚Ù†Ø§Øµ", defaultCount:0, hint:"ÙŠÙ…ØªÙ„Ùƒ Ø·Ù„Ù‚Ø© ÙˆØ§Ø­Ø¯Ø© Ù„Ù‚ØªÙ„ Ù…Ø´ØªØ¨Ù‡ (Ø­Ø³Ø¨ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯)." },
    { key:"jester",    name:"Ø§Ù„Ù…Ù‡Ø±Ù‘Ø¬", defaultCount:0, hint:"Ù‡Ø¯ÙÙ‡ ÙŠÙÙ‚ØµÙ‰ Ø¨Ø§Ù„ØªØµÙˆÙŠØª Ù„ÙŠÙÙˆØ² ÙˆØ­Ø¯Ù‡ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)." },
    { key:"lover",     name:"Ø¹Ø§Ø´Ù‚", defaultCount:0, hint:"ÙŠØ±ØªØ¨Ø· Ø¨Ù„Ø§Ø¹Ø¨ Ø¢Ø®Ø±Ø› Ø¥Ø°Ø§ Ù…Ø§Øª Ø£Ø­Ø¯ÙƒÙ…Ø§ Ù‚Ø¯ ÙŠÙ…ÙˆØª Ø§Ù„Ø«Ø§Ù†ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)." },
  ];

  // ====== Ø§Ù„Ø­Ø§Ù„Ø© ======
  const state = {
    players: [], // [{id,name,roleKey,roleName}]
    roleCounts: Object.fromEntries(ROLE_DEFS.map(r => [r.key, r.defaultCount])),
    revealIndex: 0,
    assigned: false,
  };

  // ====== Ø¹Ù†Ø§ØµØ± ======
  const screenSetup = $("screenSetup");
  const screenReveal = $("screenReveal");

  const playerName = $("playerName");
  const btnAddPlayer = $("btnAddPlayer");
  const btnAddSample = $("btnAddSample");
  const playersList = $("playersList");
  const playersCount = $("playersCount");

  const rolesBox = $("rolesBox");
  const btnAssignRoles = $("btnAssignRoles");

  const revealPlayerName = $("revealPlayerName");
  const revealIndexEl = $("revealIndex");
  const revealTotalEl = $("revealTotal");

  const btnPrevReveal = $("btnPrevReveal");
  const btnNextReveal = $("btnNextReveal");
  const btnShowRole = $("btnShowRole");
  const btnHideRole = $("btnHideRole");
  const roleCard = $("roleCard");
  const roleName = $("roleName");
  const roleHint = $("roleHint");
  const btnGoBackSetup = $("btnGoBackSetup");
  const btnResetAll = $("btnResetAll");

  // ====== Ø£Ø¯ÙˆØ§Øª ======
  const rid = () => (crypto?.getRandomValues ? [...crypto.getRandomValues(new Uint32Array(2))].map(x=>x.toString(16)).join("") : String(Math.random()).slice(2));
  const escapeHtml = (s) => String(s).replace(/[&<>"']/g, c => ({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;" }[c]));
  const shuffle = (arr) => {
    const a = arr.slice();
    for (let i = a.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  };

  // ====== Ø±Ø³Ù… Ø§Ù„Ø£Ø¯ÙˆØ§Ø± ======
  function renderRoles() {
    rolesBox.innerHTML = "";
    ROLE_DEFS.forEach(role => {
      const wrap = document.createElement("div");
      wrap.className = "rounded-2xl border border-slate-800 bg-slate-950 p-3";
      wrap.innerHTML = `
        <div class="flex items-center justify-between gap-3">
          <div>
            <div class="font-extrabold">${escapeHtml(role.name)}</div>
            <div class="text-xs text-slate-400 mt-1">${escapeHtml(role.hint)}</div>
          </div>
          <div class="flex items-center gap-2">
            <button class="tap px-3 py-2 rounded-xl bg-slate-800 hover:bg-slate-700 border border-slate-700 font-bold" data-act="dec" data-key="${role.key}">-</button>
            <div class="min-w-10 text-center font-extrabold text-lg" id="count_${role.key}">${state.roleCounts[role.key] ?? 0}</div>
            <button class="tap px-3 py-2 rounded-xl bg-slate-800 hover:bg-slate-700 border border-slate-700 font-bold" data-act="inc" data-key="${role.key}">+</button>
          </div>
        </div>
      `;
      rolesBox.appendChild(wrap);
    });

    rolesBox.querySelectorAll("button[data-act]").forEach(btn => {
      btn.addEventListener("click", () => {
        const key = btn.getAttribute("data-key");
        const act = btn.getAttribute("data-act");
        const cur = Number(state.roleCounts[key] ?? 0);
        const next = act === "inc" ? cur + 1 : Math.max(0, cur - 1);
        state.roleCounts[key] = next;
        const el = $("count_" + key);
        if (el) el.textContent = String(next);
      });
    });
  }

  // ====== Ø±Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ======
  function renderPlayers() {
    playersCount.textContent = String(state.players.length);
    playersList.innerHTML = "";

    if (state.players.length === 0) {
      const empty = document.createElement("div");
      empty.className = "text-slate-400 text-sm";
      empty.textContent = "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¨Ø¹Ø¯.";
      playersList.appendChild(empty);
      return;
    }

    state.players.forEach(p => {
      const row = document.createElement("div");
      row.className = "flex items-center justify-between rounded-2xl bg-slate-950 border border-slate-800 px-4 py-3";
      row.innerHTML = `
        <div class="font-bold">${escapeHtml(p.name)}</div>
        <button class="tap text-sm px-3 py-2 rounded-xl bg-slate-800 hover:bg-slate-700 border border-slate-700" data-del="${p.id}">âœ•</button>
      `;
      playersList.appendChild(row);
    });

    playersList.querySelectorAll("button[data-del]").forEach(btn => {
      btn.addEventListener("click", () => {
        const id = btn.getAttribute("data-del");
        state.players = state.players.filter(p => p.id !== id);
        renderPlayers();
      });
    });
  }

  // ====== Ø¥Ø¶Ø§ÙØ© Ù„Ø§Ø¹Ø¨ ======
  function addPlayer(name) {
    const n = (name ?? "").trim();
    if (!n) return;
    if (state.players.some(p => p.name === n)) {
      alert("Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù… Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„.");
      return;
    }
    state.players.push({ id: rid(), name: n, roleKey: null, roleName: null });
    playerName.value = "";
    playerName.focus();
    renderPlayers();
  }

  // ====== ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± ======
  function assign() {
    if (state.players.length < 5) {
      alert("Ø¶ÙŠÙ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ 5 Ù„Ø§Ø¹Ø¨ÙŠÙ†.");
      return;
    }

    // Ø¨Ù†Ø§Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¯ÙˆØ§Ø±
    const roles = [];
    for (const r of ROLE_DEFS) {
      const c = Number(state.roleCounts[r.key] ?? 0);
      for (let i = 0; i < c; i++) roles.push(r.key);
    }

    if (roles.length > state.players.length) {
      alert("Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± Ø£ÙƒØ¨Ø± Ù…Ù† Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†.");
      return;
    }

    // Ø§Ù„Ø¨Ø§Ù‚ÙŠ Ù…ÙˆØ§Ø·Ù†
    while (roles.length < state.players.length) roles.push("citizen");

    const rolesShuffled = shuffle(roles);
    const playersShuffled = shuffle(state.players);

    // Ø¥Ø³Ù†Ø§Ø¯
    playersShuffled.forEach((p, idx) => {
      const rk = rolesShuffled[idx];
      const def = ROLE_DEFS.find(x => x.key === rk);
      p.roleKey = rk;
      p.roleName = def ? def.name : (rk === "citizen" ? "Ù…ÙˆØ§Ø·Ù†" : rk);
    });

    state.players = playersShuffled;
    state.revealIndex = 0;
    state.assigned = true;

    goReveal();
    updateRevealUI();
  }

  function goReveal() {
    screenSetup.classList.add("hidden");
    screenReveal.classList.remove("hidden");
  }

  function goSetup() {
    screenReveal.classList.add("hidden");
    screenSetup.classList.remove("hidden");
  }

  function updateRevealUI() {
    const p = state.players[state.revealIndex];
    revealPlayerName.textContent = p?.name ?? "";
    revealIndexEl.textContent = String(state.revealIndex + 1);
    revealTotalEl.textContent = String(state.players.length);

    // Ø£Ø®ÙÙ Ø§Ù„Ø¯ÙˆØ±
    roleCard.classList.add("hidden");
    btnHideRole.classList.add("hidden");
    btnShowRole.classList.remove("hidden");
  }

  function showRole() {
    const p = state.players[state.revealIndex];
    if (!p) return;

    roleName.textContent = p.roleName || "";
    // hint
    const def = ROLE_DEFS.find(x => x.key === p.roleKey);
    roleHint.textContent = def?.hint || (p.roleKey === "citizen" ? "Ø­Ù„Ù‘Ù„ Ø§Ù„ÙƒÙ„Ø§Ù… ÙˆØµÙˆÙ‘Øª ØµØ­." : "");
    roleCard.classList.remove("hidden");
    btnShowRole.classList.add("hidden");
    btnHideRole.classList.remove("hidden");
  }

  function hideRole() {
    roleCard.classList.add("hidden");
    btnHideRole.classList.add("hidden");
    btnShowRole.classList.remove("hidden");
  }

  function nextReveal() {
    if (state.revealIndex < state.players.length - 1) {
      state.revealIndex++;
      updateRevealUI();
    }
  }

  function prevReveal() {
    if (state.revealIndex > 0) {
      state.revealIndex--;
      updateRevealUI();
    }
  }

  function resetAll() {
    if (!confirm("Ù…ØªØ£ÙƒØ¯ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù ÙƒÙ„ Ø´ÙŠØ¡.")) return;
    state.players = [];
    state.roleCounts = Object.fromEntries(ROLE_DEFS.map(r => [r.key, r.defaultCount]));
    state.revealIndex = 0;
    state.assigned = false;
    playerName.value = "";
    goSetup();
    renderRoles();
    renderPlayers();
  }

  // ====== Ø£Ø­Ø¯Ø§Ø« ======
  btnAddPlayer.addEventListener("click", () => addPlayer(playerName.value));
  playerName.addEventListener("keydown", (e) => { if (e.key === "Enter") addPlayer(playerName.value); });

  btnAddSample.addEventListener("click", () => {
    ["Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡","Ø³Ø§Ø±Ø©","ÙÙ‡Ø¯","Ù†ÙˆÙ","Ù…Ø­Ù…Ø¯","Ø±ÙŠÙ…","ØªØ±ÙƒÙŠ","Ù„Ù…Ù‰"].forEach(addPlayer);
  });

  btnAssignRoles.addEventListener("click", assign);

  btnShowRole.addEventListener("click", showRole);
  btnHideRole.addEventListener("click", hideRole);

  btnNextReveal.addEventListener("click", nextReveal);
  btnPrevReveal.addEventListener("click", prevReveal);

  btnGoBackSetup.addEventListener("click", goSetup);
  btnResetAll.addEventListener("click", resetAll);

  // ====== Ø¨Ø¯Ø¡ ======
  renderRoles();
  renderPlayers();
})();
</script>
</body>
</html>
